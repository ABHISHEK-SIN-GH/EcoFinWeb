from ceic_api_client.api_client import ApiClient
from ceic_api_client.facade.pyceic_parameter_validators import ParameterEnumValidator
from ceic_api_client.facade.pyceic_parameter_validators import ParameterDeprecatedValidator


class CeicConfiguration(object):

    _DEFAULT_RETURN_TYPE = "application/json"
    _GET_SERIES_SERIES_ID_LIMIT = 3000

    def __init__(self):
        self._api_client = ApiClient()
        self._set_default_return_type()

        self._parameter_validators = [
            ParameterEnumValidator(self.specification_url),
            ParameterDeprecatedValidator(self.specification_url)
        ]

        self._default_query_params = {}

    @property
    def api_client(self):
        return self._api_client

    @property
    def downloads_file_url(self):
        return "https://downloads-stage.ceicdata.com/downloads.json" if \
            "api-stage" in self._api_client.configuration.host else \
            "https://downloads.ceicdata.com/downloads.json"

    @property
    def python_package_url(self):
        return "https://downloads-stage.ceicdata.com/python" if \
            "api-stage" in self._api_client.configuration.host else \
            "https://downloads.ceicdata.com/python"

    @property
    def specification_url(self):
        return "https://stage.ceicdata.com/api/v2/specification" if \
            "api-stage" in self._api_client.configuration.host else \
            "https://insights.ceicdata.com/api/v2/specification"

    @property
    def parameter_validators(self):
        return self._parameter_validators

    @property
    def get_series_series_id_limit(self):
        return self._GET_SERIES_SERIES_ID_LIMIT

    @property
    def server(self):
        return self._api_client.configuration.host

    @server.setter
    def server(self, value):
        self._api_client.configuration.host = value

    @property
    def default_query_params(self):
        return self._default_query_params

    def set_token(self, access_token):
        self.default_query_params["token"] = access_token

    def unset_token(self):
        self.default_query_params.pop("token")

    def set_proxy(self, proxy_url=None, proxy_username=None, proxy_password=None):
        self._api_client.configuration.set_proxy(proxy_url, proxy_username, proxy_password)

    def _set_default_return_type(self):
        self._api_client.set_default_header("Accept", self._DEFAULT_RETURN_TYPE)
